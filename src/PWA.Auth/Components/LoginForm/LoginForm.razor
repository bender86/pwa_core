@using dto.auth.Models
@* Components/LoginForm/LoginForm.razor *@

<div class="login-form">
    @if (!string.IsNullOrEmpty(ErrorMessage))
    {
        <div class="alert alert-danger">
            @ErrorMessage
        </div>
    }

    <EditForm Model="@model" OnValidSubmit="HandleSubmit">
        <DataAnnotationsValidator />
        
        <div class="form-group">
            <label>Email / Username</label>
            <InputText @bind-Value="model.Email" 
                       class="form-control" 
                       placeholder="your@email.com" 
                       disabled="@IsLoading" />
            <ValidationMessage For="@(() => model.Email)" />
        </div>

        <div class="form-group">
            <label>Password</label>
            <InputText type="password" 
                       @bind-Value="model.Password" 
                       class="form-control" 
                       placeholder="********" 
                       disabled="@IsLoading" />
            <ValidationMessage For="@(() => model.Password)" />
        </div>

        <!-- ? Lien Forgot Password -->
        <div class="text-end mb-3">
            <a href="/forgot-password" class="forgot-password-link">
                Forgot your password?
            </a>
        </div>

        <button type="submit" class="btn btn-primary btn-block" disabled="@IsLoading">
            @if (IsLoading)
            {
                <span class="spinner-border spinner-border-sm"></span>
                <span>Connecting...</span>
            }
            else
            {
                <span>Sign In</span>
            }
        </button>
    </EditForm>
</div>

<style>
    .forgot-password-link {
        font-size: 0.875rem;
        color: #667eea;
        text-decoration: none;
        transition: color 0.2s;
    }

    .forgot-password-link:hover {
        color: #764ba2;
        text-decoration: underline;
    }
</style>

@code {
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public string? ErrorMessage { get; set; }
    [Parameter] public EventCallback<AuthenticateRequest> OnLoginSubmit { get; set; }

    // Direct use of shared DTO with API
    private AuthenticateRequest model = new()
    {
        Email = string.Empty,
        Password = string.Empty
    };

    private async Task HandleSubmit()
    {
        // Pass DTO directly, no conversion needed
        await OnLoginSubmit.InvokeAsync(model);
    }
}